# EGDesk Development Guide

This Next.js project is running in EGDesk with tunneling support.

## ⚠️ Important: Client-Side API Calls

**Next.js basePath does NOT automatically apply to client-side `fetch()` calls.**

This is a known Next.js limitation that affects all projects using `basePath`.

### ❌ Wrong - Will Return 404

```javascript
// This will fail when running through EGDesk tunnel
fetch('/api/transactions')
```

### ✅ Correct - Use Environment Variable

```javascript
const basePath = process.env.NEXT_PUBLIC_EGDESK_BASE_PATH || '';
fetch(`${basePath}/api/transactions`)
```

## Recommended: Create API Wrapper Function

Create a reusable wrapper in `lib/api.ts`:

```typescript
// lib/api.ts
const basePath = process.env.NEXT_PUBLIC_EGDESK_BASE_PATH || '';

export async function apiFetch(path: string, options?: RequestInit) {
  // Automatically prepend basePath to relative URLs
  const url = path.startsWith('/') && !path.startsWith('//')
    ? `${basePath}${path}`
    : path;
  return fetch(url, options);
}
```

Then use it everywhere instead of `fetch()`:

```typescript
import { apiFetch } from '@/lib/api';

// In your components
const response = await apiFetch('/api/transactions');
const data = await response.json();
```

## Environment Variables Provided by EGDesk

EGDesk automatically sets these when starting your dev server:

- `NEXT_PUBLIC_EGDESK_BASE_PATH` - The tunnel path prefix (e.g., `/t/abc123/p/my-app`)
- `NEXT_PUBLIC_EGDESK_API_KEY` - Your EGDesk API key (for database/sheets access)
- `NEXT_PUBLIC_EGDESK_API_URL` - EGDesk API endpoint (usually `http://localhost:8080`)

## What Works Automatically

✅ Next.js routing (`router.push()`, `<Link>`, etc.)
✅ Server-side rendering and API routes
✅ Static assets (`/_next/static/...`)
✅ Images via `next/image`

❌ Client-side `fetch()` calls - **You must handle this manually**

## For AI Assistants

When building features for this Next.js project:

1. **Always create `lib/api.ts` wrapper** at the start of the project
2. **Use `apiFetch()` instead of `fetch()`** for all API calls in components
3. **Never use bare `fetch('/api/...')`** - it will fail in EGDesk tunnel
4. **Inform the user** about this limitation when implementing API features

## Troubleshooting

### API calls return 404

Check if you're using `fetch()` directly instead of the wrapper:

```javascript
// ❌ This will fail
fetch('/api/users')

// ✅ Use this instead
const basePath = process.env.NEXT_PUBLIC_EGDESK_BASE_PATH || '';
fetch(`${basePath}/api/users`)

// ✅ Or better, use the wrapper
apiFetch('/api/users')
```

### Assets (fonts, CSS) return 404

This usually means the basePath configuration wasn't applied correctly.
EGDesk automatically configures this - try restarting the dev server.

---

*This file is auto-generated by EGDesk. Do not modify.*
